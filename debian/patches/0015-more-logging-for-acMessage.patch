From: Patrick Brunschwig <patrick@enigmail.net>
Date: Thu, 29 Mar 2018 18:30:29 +0200
Subject: more logging for acMessage

(cherry picked from commit 54ca86384fdfc167c74e40493ed80e394ba64292)
---
 package/autocrypt.jsm | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/package/autocrypt.jsm b/package/autocrypt.jsm
index 6f53f1e..b62e6ff 100644
--- a/package/autocrypt.jsm
+++ b/package/autocrypt.jsm
@@ -390,6 +390,12 @@ var EnigmailAutocrypt = {
         'Autocrypt-Prefer-Encrypt': preferEncrypt
       }) + '\r\n';
 
+      if (!innerMsg || innerMsg.length === 0) {
+        EnigmailLog.DEBUG("autocrypt.jsm: createSetupMessage: empty key data after replaceArmorHeaders\n");
+        reject(1);
+        return;
+      }
+
       let bkpCode = createBackupCode();
       let enc = {
         data: innerMsg,
