From: Patrick Brunschwig <patrick@enigmail.net>
Date: Thu, 29 Mar 2018 19:11:48 +0200
Subject: fixed bug 781: endless loop if key ring empty

(cherry picked from commit 8c634b6f6c32a2aa6804326fdc518dd5a59be309)
---
 ui/content/enigmailKeyManager.js | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/ui/content/enigmailKeyManager.js b/ui/content/enigmailKeyManager.js
index fa2e2d7..7548947 100644
--- a/ui/content/enigmailKeyManager.js
+++ b/ui/content/enigmailKeyManager.js
@@ -127,7 +127,17 @@ function refreshKeys() {
 }
 
 function reloadKeys() {
-  buildKeyList(false);
+  let i = 0;
+  let c = Components.stack;
+
+  while (c) {
+    if (c.name == "reloadKeys") i++;
+    c = c.caller
+  }
+
+  // detect recursion and don't continue if too much recursion
+  // this can happen if the key list is empty
+  if (i < 4) buildKeyList(false);
 }
 
 function buildKeyList(refresh) {
