From: Patrick Brunschwig <patrick@enigmail.net>
Date: Wed, 28 Mar 2018 13:25:25 +0200
Subject: fixed charset issue (bug 765)

(cherry picked from commit b5754a322eeb1ff48d5f0927a781478b852ae0d9)
---
 package/pEpDecrypt.jsm | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/package/pEpDecrypt.jsm b/package/pEpDecrypt.jsm
index f4b1c30..e402408 100644
--- a/package/pEpDecrypt.jsm
+++ b/package/pEpDecrypt.jsm
@@ -24,6 +24,7 @@ Cu.import("resource://enigmail/locale.jsm"); /*global EnigmailLocale: false */
 Cu.import("resource://enigmail/mimeVerify.jsm"); /*global EnigmailVerify: false */
 Cu.import("resource://enigmail/uris.jsm"); /*global EnigmailURIs: false */
 Cu.import("resource://enigmail/streams.jsm"); /*global EnigmailStreams: false */
+Cu.import("resource://enigmail/data.jsm"); /*global EnigmailData: false */
 Cu.import("resource:///modules/jsmime.jsm"); /*global jsmime: false*/
 Cu.import("resource://enigmail/singletons.jsm"); /*global EnigmailSingletons: false */
 
@@ -244,8 +245,9 @@ PEPDecryptor.prototype = {
     this.decryptedData = 'Content-Type: multipart/mixed; boundary="' + wrapper + '"\r\n' +
       'Content-Disposition: inline\r\n\r\n' +
       '--' + wrapper + '\r\n' +
-      "Content-Type: text/plain\r\n\r\n" + EnigmailLocale.getString("pEpDecrypt.cannotDecrypt") + '\r\n' +
-      '--' + wrapper + '--\r\n';
+      'Content-Type: text/plain; charset="UTF-8"\r\n\r\n' +
+      EnigmailData.convertFromUnicode(EnigmailLocale.getString("pEpDecrypt.cannotDecrypt"), "UTF-8") +
+      '\r\n--' + wrapper + '--\r\n';
 
     this.sourceData = "Content-Type: " + this.contentType + "\r\n\r\n" + this.sourceData;
 
