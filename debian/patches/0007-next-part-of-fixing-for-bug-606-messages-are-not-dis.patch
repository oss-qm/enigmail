From: Patrick Brunschwig <patrick@enigmail.net>
Date: Wed, 22 Jun 2016 17:17:47 +0200
Subject: next part of fixing for bug 606 - messages are not displayed for
 news:// URLs

---
 ui/content/enigmailMsgHdrViewOverlay.js | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/ui/content/enigmailMsgHdrViewOverlay.js b/ui/content/enigmailMsgHdrViewOverlay.js
index f23cff9..1f688c5 100644
--- a/ui/content/enigmailMsgHdrViewOverlay.js
+++ b/ui/content/enigmailMsgHdrViewOverlay.js
@@ -764,7 +764,7 @@ Enigmail.hdrView = {
   msgHdrViewUnhide: function(event) {
     EnigmailLog.DEBUG("enigmailMsgHdrViewOverlay.js: this.msgHdrViewUnhide:\n");
 
-    if (Enigmail.msg.securityInfo.statusFlags !== 0) {
+    if (Enigmail.msg.securityInfo && Enigmail.msg.securityInfo.statusFlags !== 0) {
       this.enigmailBox.removeAttribute("collapsed");
     }
   },
@@ -997,14 +997,18 @@ if (messageHeaderSink) {
         catch (ex) {
           EnigmailLog.DEBUG("enigmailMsgHdrViewOverlay.js: EnigMimeHeaderSink.isCurrentMessage: could not determine URL\n");
           url.value = {
+            host: "invalid",
+            path: "/message",
+            scheme: "enigmail",
             spec: "enigmail://invalid/message"
           };
         }
 
         EnigmailLog.DEBUG("enigmailMsgHdrViewOverlay.js: EnigMimeHeaderSink.isCurrentMessage: url=" + url.value.spec + "\n");
 
-        if (!uriSpec || uriSpec.search(/^enigmail:/) === 0 || (uriSpec.indexOf(url.value.spec) === 0 &&
-            uriSpec.substr(url.value.spec.length).search(/([\?&].*)?$/) === 0)) {
+        if (!uriSpec || uriSpec.search(/^enigmail:/) === 0 ||
+          (uri.host == url.value.host &&
+            uri.path.substr(url.value.path.length).search(/([\?&].*)?$/) === 0)) {
           return true;
         }
 
