From: Willi Mann <willi@wm1.at>
Date: Fri, 22 Feb 2013 19:26:18 +0100
Subject: Add patch to fix upstream version in install.rdf (1.6a1pre -> 1.5.1,
 closes: #700890)

---
 debian/changelog                                   |    7 ++++++
 debian/patches/0003-0004-default-to-PGP-MIME.patch |   21 +++++++++++++++++
 debian/patches/0003-default-to-PGP-MIME.patch      |   22 ------------------
 ...-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch |   21 +++++++++++++++++
 ...LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch |   24 --------------------
 .../0005-Fix-upstream-version-in-install.rdf.patch |   21 +++++++++++++++++
 debian/patches/series                              |    5 ++--
 7 files changed, 73 insertions(+), 48 deletions(-)
 create mode 100644 debian/patches/0003-0004-default-to-PGP-MIME.patch
 delete mode 100644 debian/patches/0003-default-to-PGP-MIME.patch
 create mode 100644 debian/patches/0004-0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch
 delete mode 100644 debian/patches/0004-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch
 create mode 100644 debian/patches/0005-Fix-upstream-version-in-install.rdf.patch

diff --git a/debian/changelog b/debian/changelog
index 1d1b721..b917ac4 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,10 @@
+enigmail (2:1.5.1+id17-2~) UNRELEASED; urgency=low
+
+  * Add patch to fix upstream version in install.rdf (1.6a1pre -> 1.5.1,
+    closes: #700890)
+
+ -- Willi Mann <willi@debian.org>  Fri, 22 Feb 2013 19:23:49 +0100
+
 enigmail (2:1.5.1+id17-1) experimental; urgency=low
 
   * Imported Upstream version 1.5.1+id17
diff --git a/debian/patches/0003-0004-default-to-PGP-MIME.patch b/debian/patches/0003-0004-default-to-PGP-MIME.patch
new file mode 100644
index 0000000..71dbd20
--- /dev/null
+++ b/debian/patches/0003-0004-default-to-PGP-MIME.patch
@@ -0,0 +1,21 @@
+From: Alexander Sack <asac@debian.org>
+Date: Wed, 6 Feb 2013 19:19:46 +0100
+Subject: 0004-default-to-PGP-MIME
+
+---
+ extensions/enigmail/package/prefs/enigmail.js |    2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/extensions/enigmail/package/prefs/enigmail.js b/extensions/enigmail/package/prefs/enigmail.js
+index 3c99b0f..f235df6 100644
+--- a/extensions/enigmail/package/prefs/enigmail.js
++++ b/extensions/enigmail/package/prefs/enigmail.js
+@@ -216,7 +216,7 @@ pref("mail.identity.default.pgpSignEncrypted", false);
+ pref("mail.identity.default.defaultEncryptionPolicy", 0);
+ pref("mail.identity.default.openPgpHeaderMode", 0);
+ pref("mail.identity.default.openPgpUrlName", "");
+-pref("mail.identity.default.pgpMimeMode", false);
++pref("mail.identity.default.pgpMimeMode", true);
+ pref("mail.identity.default.attachPgpKey", false);
+ 
+ /*
diff --git a/debian/patches/0003-default-to-PGP-MIME.patch b/debian/patches/0003-default-to-PGP-MIME.patch
deleted file mode 100644
index c4e8bb8..0000000
--- a/debian/patches/0003-default-to-PGP-MIME.patch
+++ /dev/null
@@ -1,22 +0,0 @@
-From: Daniel Kahn Gillmor <dkg@fifthhorseman.net>
-Date: Wed, 6 Feb 2013 19:19:46 +0100
-Subject: 0004-default-to-PGP-MIME
-Bug: http://bugs.debian.org/698084
-
----
- extensions/enigmail/package/prefs/enigmail.js |    2 +-
- 1 file changed, 1 insertion(+), 1 deletion(-)
-
-diff --git a/extensions/enigmail/package/prefs/enigmail.js b/extensions/enigmail/package/prefs/enigmail.js
-index 3c99b0f..f235df6 100644
---- a/extensions/enigmail/package/prefs/enigmail.js
-+++ b/extensions/enigmail/package/prefs/enigmail.js
-@@ -216,7 +216,7 @@ pref("mail.identity.default.pgpSignEncrypted", false);
- pref("mail.identity.default.defaultEncryptionPolicy", 0);
- pref("mail.identity.default.openPgpHeaderMode", 0);
- pref("mail.identity.default.openPgpUrlName", "");
--pref("mail.identity.default.pgpMimeMode", false);
-+pref("mail.identity.default.pgpMimeMode", true);
- pref("mail.identity.default.attachPgpKey", false);
- 
- /*
diff --git a/debian/patches/0004-0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch b/debian/patches/0004-0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch
new file mode 100644
index 0000000..a18a92c
--- /dev/null
+++ b/debian/patches/0004-0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch
@@ -0,0 +1,21 @@
+From: Alexander Sack <asac@debian.org>
+Date: Wed, 6 Feb 2013 19:19:47 +0100
+Subject: 0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage
+
+---
+ extensions/enigmail/ipc/src/Makefile.in |    2 --
+ 1 file changed, 2 deletions(-)
+
+diff --git a/extensions/enigmail/ipc/src/Makefile.in b/extensions/enigmail/ipc/src/Makefile.in
+index 1d75607..dc7ed40 100644
+--- a/extensions/enigmail/ipc/src/Makefile.in
++++ b/extensions/enigmail/ipc/src/Makefile.in
+@@ -10,8 +10,6 @@ VPATH           = @srcdir@
+ include $(DEPTH)/config/autoconf.mk
+ 
+ OBJ_SUFF = o
+-LDFLAGS =
+-CFLAGS =
+ 
+ ifeq ($(OS_ARCH),Darwin)
+ LDFLAGS	+= -dynamiclib -install_name @executable_path/$(SHARED_LIBRARY) -compatibility_version 1 -current_version 1 -single_module
diff --git a/debian/patches/0004-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch b/debian/patches/0004-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch
deleted file mode 100644
index e24e498..0000000
--- a/debian/patches/0004-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch
+++ /dev/null
@@ -1,24 +0,0 @@
-From: Daniel Kahn Gillmor <dkg@fifthhorseman.net>
-Date: Wed, 6 Feb 2013 19:19:47 +0100
-Subject: 0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage
-
-This is to enable hardening in the binary components.
-
-See: https://wiki.debian.org/Hardening
----
- extensions/enigmail/ipc/src/Makefile.in |    2 --
- 1 file changed, 2 deletions(-)
-
-diff --git a/extensions/enigmail/ipc/src/Makefile.in b/extensions/enigmail/ipc/src/Makefile.in
-index 1d75607..dc7ed40 100644
---- a/extensions/enigmail/ipc/src/Makefile.in
-+++ b/extensions/enigmail/ipc/src/Makefile.in
-@@ -10,8 +10,6 @@ VPATH           = @srcdir@
- include $(DEPTH)/config/autoconf.mk
- 
- OBJ_SUFF = o
--LDFLAGS =
--CFLAGS =
- 
- ifeq ($(OS_ARCH),Darwin)
- LDFLAGS	+= -dynamiclib -install_name @executable_path/$(SHARED_LIBRARY) -compatibility_version 1 -current_version 1 -single_module
diff --git a/debian/patches/0005-Fix-upstream-version-in-install.rdf.patch b/debian/patches/0005-Fix-upstream-version-in-install.rdf.patch
new file mode 100644
index 0000000..4d06a29
--- /dev/null
+++ b/debian/patches/0005-Fix-upstream-version-in-install.rdf.patch
@@ -0,0 +1,21 @@
+From: Willi Mann <willi@wm1.at>
+Date: Fri, 22 Feb 2013 19:22:56 +0100
+Subject: Fix upstream version in install.rdf
+
+---
+ extensions/enigmail/package/install.rdf |    2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/extensions/enigmail/package/install.rdf b/extensions/enigmail/package/install.rdf
+index 7708f23..450e413 100644
+--- a/extensions/enigmail/package/install.rdf
++++ b/extensions/enigmail/package/install.rdf
+@@ -5,7 +5,7 @@
+ 
+   <Description about="urn:mozilla:install-manifest">
+     <em:id>{847b3a00-7ab1-11d4-8f02-006008948af5}</em:id>
+-    <em:version>1.6a1pre</em:version>
++    <em:version>1.5.1</em:version>
+     <em:type>2</em:type> <!-- type = extension -->
+     <em:unpack>true</em:unpack>
+ 
diff --git a/debian/patches/series b/debian/patches/series
index 0d32bb6..9570377 100644
--- a/debian/patches/series
+++ b/debian/patches/series
@@ -1,4 +1,5 @@
 0001-makefile_depth.patch
 0002-add-cachedir-.-to-xpidl-generator-calls.patch
-0003-default-to-PGP-MIME.patch
-0004-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackage.patch
+0003-0004-default-to-PGP-MIME.patch
+0004-0006-accept-LDFLAGS-and-CFLAGS-from-dpkg-buildpackag.patch
+0005-Fix-upstream-version-in-install.rdf.patch
